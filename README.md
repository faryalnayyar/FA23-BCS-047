# Flight Price Tracker API

This is a Python-based, automated system for tracking flight ticket prices over time. It uses a Flask API, a MongoDB database, and an APScheduler to automatically log price changes for specified flight routes.

## Project Structure
## Tech Stack

* **Backend:** Python 3
* **API:** Flask
* **Database:** MongoDB Atlas
* **Python Driver:** PyMongo
* **Scheduler:** APScheduler
* **Search:** MongoDB Atlas Search
* **Testing:** Postman

## How to Run

1.  **Install dependencies:**
    ```bash
    pip install flask pymongo apscheduler python-dotenv
    ```

2.  **Create `.env` file:**
    Create a `.env` file in the root folder and add your MongoDB Atlas connection string:
    ```
    MONGO_URI=mongodb+srv://<user>:<password>@<cluster-url>...
    ```

3.  **Seed the Database:**
    Run this command once to load the sample data from `dataset.json`.
    ```bash
    python seed.py
    ```

4.  **Run the API Server:**
    Open a terminal and run:
    ```bash
    flask run
    ```
    The server will be running on `http://127.0.0.1:5000`.

5.  **Run the Scheduler:**
    Open a **second terminal** and run:
    ```bash
    python scheduler.py
    ```
    This bot will now run in the background, checking for prices.

## API Endpoints

### Create New Tracking Job
* **Method:** `POST`
* **URL:** `/api/v1/track`
* **Body (JSON):**
    ```json
    {
      "origin": "JFK",
      "destination": "LHR",
      "airline": "British Airways",
      "departureDate": "2026-03-01T20:00:00Z",
      "trackingStartDate": "2025-01-01T00:00:00Z",
      "trackingIntervalMinutes": 1440,
      "description": "Business trip to London"
    }
    ```

### Get Price History
* **Method:** `GET`
* **URL:** `/api/v1/track/<job_id>/history`
* **Example:** `/api/v1/track/68f8f7e1cb2a56d45dba3b62/history`
* **Success Response (200):**
    ```json
    [
      {
        "_id": "68f8fac987a2cdc3f48a92a4",
        "currency": "USD",
        "price": 573.47,
        "source": "MockFetcher",
        "timestamp": "2025-10-22T15:39:53.857000",
        "trackedFlightId": "68f8f7e1cb2a56d45dba3b62"
      }
    ]
    ```

### Search for Jobs (Hybrid Search)
* **Method:** `GET`
* **URL:** `/api/v1/search`
* **Query Parameters:**
    * `q` (text search on description)
    * `origin` (filter by origin)
    * `airline` (filter by airline)
* **Example:** `/api/v1/search?q=trip&origin=LHE`
* **Success Response (200):**
    ```json
    [
      {
        "_id": "68f8f7e1cb2a56d45dba3b62",
        "origin": "LHE",
        "destination": "JED",
        "description": "Umrah trip for family in February",
        "searchScore": 0.875
      }
    ]
    ```
#Database Schema

Our database (named flight_tracker_db) uses two collections: tracked_flights and price_history.

#Schema Relationships

This schema uses a One-to-Many relationship, implemented by referencing.

One document in the tracked_flights collection (the "parent" job).
...can be related to Many documents in the price_history collection (the "child" price logs).

This link is created by storing the _id of the parent tracked_flight document inside the trackedFlightId field of each price_history document. This allows us to efficiently query all the price logs for a single tracking job.
Our database (named flight_tracker_db) uses two collections: tracked_flights and price_history.

1. tracked_flights Collection
This collection stores the configuration for each flight tracking job. Each document has the following attributes:

_id (ObjectId): Unique identifier for the tracking job, generated by MongoDB. (Index: Default)

origin (String): The flight's origin airport code (e.g., "LHE"). (Index: Search)

destination (String): The flight's destination airport code (e.g., "JED"). (Index: No)

airline (String): The airline to track (e.g., "Saudia"). (Index: Search)

departureDate (ISODate): The date and time the flight is scheduled to depart. (Index: Search)

trackingStartDate (ISODate): The date when the scheduler should start tracking this flight. (Index: No)

trackingIntervalMinutes (Number): How often (in minutes) the scheduler should check the price (e.g., 1440 for once a day). (Index: No)

status (String): The current state of the job (e.g., "ACTIVE", "PAUSED"). (Index: Yes, for scheduler)

description (String): A user-friendly description (e.g., "Umrah trip..."). (Index: Search, for text search)

lastCheckedTimestamp (ISODate): The last time the scheduler checked this flight's price. (Index: Yes, for scheduler)

#Field Descriptions:
_id (ObjectId): A unique ID for the tracking job, generated by MongoDB.

origin (String): The flight's origin airport (e.g., "LHE"). Indexed for search.

destination (String): The flight's destination airport (e.g., "JED").

airline (String): The airline to track (e.g., "Saudia"). Indexed for search.

departureDate (ISODate): The date and time the flight is scheduled to depart. Indexed for search.

trackingStartDate (ISODate): The date when the scheduler should start tracking this flight.

trackingIntervalMinutes (Number): How often (in minutes) the scheduler should check the price (e.g., 1440 for once a day).

status (String): The current state of the job (e.g., "ACTIVE", "PAUSED", "COMPLETED"). Indexed for scheduler.

description (String): A description for the user (e.g., "Umrah trip..."). Indexed for text search.

lastCheckedTimestamp (ISODate): The last time the scheduler checked this flight's price. Indexed for scheduler.

2. price_history Collection
This collection stores the results from the scheduler. Every time the scheduler checks a price, it adds one document with the following attributes:

_id (ObjectId): Unique identifier for this specific price log. (Index: Default)

trackedFlightId (ObjectId): Links this price log to the _id in the tracked_flights collection. (Index: Yes)

timestamp (ISODate): The date and time when this price was recorded. (Index: Yes)

price (Number): The price that was found (e.g., 654.73). (Index: No)

currency (String): The currency of the price (e.g., "USD"). (Index: No)

source (String): Where the price data came from (e.g., "MockFetcher"). (Index: No)
 
 #How to Run

#Install dependencies:

pip install flask pymongo apscheduler python-dotenv


Create .env file:
Create a .env file in the root folder and add your MongoDB Atlas connection string:

MONGO_URI=mongodb+srv://<user>:<password>@<cluster-url>...


#Seed the Database:
Run this command once to load the sample data from dataset.json.
python seed.py


#Run the API Server:
Open a terminal and run:
flask run

The server will be running on http://127.0.0.1:5000.

#Run the Scheduler:
Open a second terminal and run:

python scheduler.py
This bot will now run in the background, checking for prices.

#API Endpoints

 Create New Tracking Job
 Method: POST
 URL: /api/v1/track
Body (JSON):

{
  "origin": "JFK",
  "destination": "LHR",
  "airline": "British Airways",
  "departureDate": "2026-03-01T20:00:00Z",
  "trackingStartDate": "2025-01-01T00:00:00Z",
  "trackingIntervalMinutes": 1440,
  "description": "Business trip to London"
}


Get Price History

Method: GET
URL: /api/v1/track/<job_id>/history


Example: /api/v1/track/68f8f7e1cb2a56d45dba3b62/history
Search for Jobs (Hybrid Search)
Method: GET
URL: /api/v1/search

Query Parameters:

q (text search on description)
origin (filter by origin)
airline (filter by airline)
Example: /api/v1/search?q=trip&origin=LHE
